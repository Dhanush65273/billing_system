{% extends "base.html" %}
{% block title %}Invoice #{{ invoice.id }}{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Invoice #{{ invoice.id }}</h2>

    <a href="{% url 'invoice_pdf' invoice.id %}" class="btn btn-outline-danger">
        Download PDF
    </a>
</div>

<hr>

<!-- ================= Invoice Info ================= -->
<div class="row mb-4">
    <div class="col-md-6">
        <h5>Customer Details</h5>
        <p class="mb-1"><strong>Name:</strong> {{ invoice.customer.name }}</p>
        <p class="mb-1"><strong>Date:</strong> {{ invoice.date|date:"d-m-Y" }}</p>
        <p class="mb-1">
            <strong>Status:</strong>
            {% if invoice.status == "paid" %}
                <span class="badge bg-success">PAID</span>
            {% elif invoice.status == "partial" %}
                <span class="badge bg-warning text-dark">PARTIAL</span>
            {% else %}
                <span class="badge bg-danger">UNPAID</span>
            {% endif %}
        </p>
    </div>
</div>

<!-- ================= Items Table ================= -->
<table class="table table-bordered">
    <thead class="table-light">
        <tr>
            <th>S.No</th>
            <th>Product</th>
            <th>Qty</th>
            <th>Unit Price (₹)</th>
            <th>Line Total (₹)</th>
        </tr>
    </thead>
    <tbody>
        {% for item in items %}
        <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ item.product.name }}</td>
            <td>{{ item.quantity }}</td>
            <td>{{ item.unit_price|floatformat:2 }}</td>
            <td>{{ item.line_total|floatformat:2 }}</td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="5" class="text-center text-muted">
                No items added
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- ================= Totals (ITEM-WISE) ================= -->
<div class="row justify-content-end">
    <div class="col-md-5">
        <table class="table">
            <tr>
                <th>Subtotal</th>
                <td class="text-end">₹ {{ subtotal|floatformat:2 }}</td>
            </tr>

            <tr>
                <th>Total Discount</th>
                <td class="text-end">₹ {{ total_discount|floatformat:2 }}</td>
            </tr>

            <tr>
                <th>Total Tax</th>
                <td class="text-end">₹ {{ total_tax|floatformat:2 }}</td>
            </tr>

            <tr class="table-success">
                <th>Grand Total</th>
                <td class="text-end fw-bold">
                    ₹ {{ grand_total|floatformat:2 }}
                </td>
            </tr>

            <tr>
                <th>Paid</th>
                <td class="text-end">₹ {{ total_paid|floatformat:2 }}</td>
            </tr>

            <tr class="table-warning">
                <th>Balance</th>
                <td class="text-end fw-bold">
                    ₹ {{ balance|floatformat:2 }}
                </td>
            </tr>
        </table>
    </div>
</div>

<a href="{% url 'invoice_list' %}" class="btn btn-secondary mt-3">
    Back to Invoices
</a>

{% endblock %}
