{% extends 'base.html' %}
{% block title %}Invoice {{ invoice.id }}{% endblock %}

{% block content %}
<h2>Invoice #{{ invoice.id }}</h2>

<p><strong>Date:</strong> {{ invoice.date|date:"M d, Y" }}</p>
<p><strong>Customer:</strong> {{ invoice.customer.name }}</p>
<p><strong>Status:</strong> {{ invoice.get_status_display }}</p>

<h4 class="mt-4">Items</h4>
<table class="table table-bordered">
  <thead>
    <tr>
      <th>S.No</th>
      <th>Product</th>
      <th>Qty</th>
      <th>Unit price</th>
      <th>Line total</th>
    </tr>
  </thead>

  <tbody>
    {% for item in invoice.items.all %}
    <tr>
      <td>{{ forloop.counter }}</td>
      <td>{{ item.product.name }}</td>
      <td>{{ item.quantity }}</td>
      <td>{{ item.unit_price }}</td>
      <td>{{ item.line_total }}</td>
    </tr>
    {% endfor %}
  </tbody>

  <!-- NEW: row showing total after discount + tax -->
  <tfoot>
    <tr>
      <th colspan="4" class="text-end">Total (after discount & tax)</th>
      <th>{{ grand_total }}</th>
    </tr>
  </tfoot>
</table>


<div class="d-flex justify-content-end">
  <div style="min-width:260px;">

    <div class="d-flex justify-content-between">
      <span>Subtotal:</span>
      <span>{{ subtotal }}</span>
    </div>

    <div class="d-flex justify-content-between">
      <span>Discount:</span>
      <span>{{ discount }}</span>
    </div>

    <div class="d-flex justify-content-between">
      <span>Tax (%):</span>
      <span>{{ tax_percent|floatformat:2 }}</span>
    </div>

    <div class="d-flex justify-content-between">
      <span>Tax Amount:</span>
      <span>{{ tax_amount }}</span>
    </div>

    <div class="d-flex justify-content-between">
      <span>Total:</span>
      <span>{{ grand_total }}</span>
    </div>

    <div class="d-flex justify-content-between">
      <span>Paid:</span>
      <span>{{ total_paid }}</span>
    </div>

    <div class="d-flex justify-content-between text-danger fw-bold">
      <span>Balance:</span>
      <span>{{ invoice.balance|floatformat:2 }}</span>
    </div>
  </div>
</div>
{% endblock %}
