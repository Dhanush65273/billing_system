{% extends 'base.html' %}
{% block title %}Invoices{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2 class="mb-0">Invoices</h2>
<a href="{% url 'invoice_create' %}" class="btn btn-primary">
    New Invoice
</a>

</div>

<form method="get" class="row g-2 mb-3">
  <div class="col-md-4">
    <input
      type="text"
      name="q"
      value="{{ search_query }}"
      class="form-control"
      placeholder="Search by invoice ID or customer name"
    >
  </div>
  <div class="col-md-2">
    <button class="btn btn-outline-primary w-100" type="submit">Search</button>
  </div>
  <div class="col-md-2">
    <a href="{% url 'invoice_list' %}" class="btn btn-outline-secondary w-100">
      Clear
    </a>
  </div>
</form>

<table class="table table-striped align-middle">
  <thead>
    <tr>
      <th>ID</th>
      <th>Date</th>
      <th>Customer</th>
      <th>Total (₹)</th>
      <th>Status</th>
      <th style="width: 220px;">Actions</th>
    </tr>
  </thead>

  <tbody>
    {% for inv in invoices %}
    <tr>
      <td>{{ forloop.counter }}</td>
      <td>{{ inv.date|date:"M d, Y" }}</td>
      <td>{{ inv.customer.name }}</td>
      <td>₹ {{ inv.grand_total|floatformat:2 }}</td>

      <td>
        {% if inv.status == 'paid' %}
          <span class="badge bg-success">PAID</span>
        {% elif inv.status == 'partial' %}
          <span class="badge bg-warning text-dark">PARTIAL</span>
        {% elif inv.status == 'cancelled' %}
          <span class="badge bg-secondary">CANCELLED</span>
        {% else %}
          <span class="badge bg-danger">UNPAID</span>
        {% endif %}
      </td>

      <!-- ✅ ACTIONS (ALL INSIDE ONE TD) -->
      <td>
        <a href="{% url 'invoice_detail' inv.id %}"
           class="btn btn-sm btn-info">
          View
        </a>

        <a href="{% url 'invoice_edit' inv.id %}"
           class="btn btn-sm btn-warning">
          Edit
        </a>

        <form method="post"
              action="{% url 'invoice_delete' inv.id %}"
              class="d-inline">
          {% csrf_token %}
          <button type="submit"
                  class="btn btn-sm btn-danger"
                  onclick="return confirm('Are you sure you want to delete this invoice?');">
            Delete
          </button>
        </form>
      </td>
    </tr>

    {% empty %}
    <tr>
      <td colspan="6" class="text-center">No invoices yet.</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
